%{
Ref: Mills KC, Karagadde S, Lee PD, Yuan L, Shahbazian F. Calculation of physical properties for use in models of continuous casting process-part 1: mould slags. ISIJ international. 2016 Feb 15;56(2):264-73.
Ref: Mills, K. C., & Keene, B. J. (1987). Physical properties of BOS slags. International Materials Reviews, 32(1), 1–120. https://doi.org/10.1179/095066087790150296
Ref: Mills, K. C. (2011). The Estimation Of Slag Properties. Southern African Pyrometallurgy 2011 International Conference, March, 1–52. http://www.pyrometallurgy.co.za/KenMills/KenMills.pdf
 
DV_DT needs a better reference 

Output in g/cm^3
%}

function [Rho_Mills] =  Rho_Mills(T,XSiO2,XTiO2,XAl2O3,XCr2O3,XFeO,XMgO,XMnO,XCaO,XNa2O,XK2O,XLi2O,XCaF2,XZrO2,XB2O3,XCrO,XNiO,XFe2O3,XBaO,XSrO)

feed_mol_frac =  [XSiO2, XTiO2, XAl2O3, XCr2O3,   XFeO,   XMgO, XMnO,   XCaO, XNa2O,  XK2O, XLi2O, XCaF2,  XZrO2, XB2O3, XCrO,  XNiO, XFe2O3,   XBaO,   XSrO]';
Mol_Weight = [  60, 79.9, 101.9,   152, 71.85,  40.3,  71, 56.08,   62, 94.2, 29.8,   78, 123.2, 69.8,  68, 74.7, 159.7, 153.3, 103.6]';


% Call supporting Functions
    [~,~,T_Liq,~] = Temps(T,XSiO2,XTiO2,XAl2O3,XCr2O3,XFeO,XMgO,XMnO,XCaO,XNa2O,XK2O,XLi2O,XCaF2,XZrO2,XB2O3,XCrO,XNiO,XFe2O3,XBaO,XSrO);
    [q,Qf,NBO_T,NBO_T2] = Q(T,XSiO2,XTiO2,XAl2O3,XCr2O3,XFeO,XMgO,XMnO,XCaO,XNa2O,XK2O,XLi2O,XCaF2,XZrO2,XB2O3,XCrO,XNiO,XFe2O3,XBaO,XSrO);

% Actual Model
    V1773 = XSiO2*(19.55+7.966*XSiO2)...                          
            +XAl2O3*(28.3+32*XAl2O3+31.45*XAl2O3^2)...     
            +20.7*XCaO...
            +16.1*XMgO...
            +33*XNa2O...
            +51.8*XK2O...
            +13.3*XLi2O...
            +15.8*XFeO...
            +15.6*XMnO...
            +31.3*XCaF2...
            +36*XZrO2...
            +24*XTiO2...
            +38.4*XB2O3...
            +29.2*XCr2O3...
            +10.5*XCrO...
            +14.5*XNiO...
            +38.4*XFe2O3...
            +31.8*XB2O3...
            +28*XSrO;                                                  
        
        %DV_DT = sum([-0.42*XSiO2,3.97*XCaO,1.02*XAl2O3,2.22*XMgO,7.4*XNa2O,2*XK2O,1.5*XLi2O,4.15*XFeO,4*XMnO,5.1*XCaF2,0.81*XTiO2,4*XB2O3]*(T-1773));
        
        
    if T>=T_Liq
        Rho_Mills = sum(Mol_Weight.*feed_mol_frac)/(V1773*(1+1e-4 *(T-1773)));                        
    else
        V_298 = XSiO2*(23.76+3.5*XSiO2)+...     
                 XAl2O3*40.4...
                 +14.4*XCaO...
                 +12.5*XMgO...
                 +20.2*XNa2O...
                 +33.5*XK2O...
                 +11*XLi2O...
                 +16.5*XFeO...
                 +17*XMnO...
                 +28.5*XCaF2...
                 +40*XB2O3...
                 +20.5*XCr2O3...
                 +26.9*XFe2O3...
                 +19.6*XSrO;
                          
        if Qf<=2.8 %Crystalline 
            Rho_Mills = sum(Mol_Weight.*feed_mol_frac)/(V_298*(1+(9e-6*(T-298)))^3);
        else % Glassy
            Rho_Mills = sum(Mol_Weight.*feed_mol_frac)/((V_298*(1+(9e-6*(T-298)))^3)+...
                ((T-298)*((V1773*(1+(T_Liq-1773)/10000))-(V_298)))/(T_Liq-298));
        end
    end
    
    %Rho_Mills = 1/(Rho_Mills*1e6);
    
end
